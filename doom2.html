<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini-Doom Clone</title>
<style>
  html, body { margin:0; padding:0; overflow:hidden; background:black; }
  canvas { display:block; }
  #hud {
    position:absolute; bottom:0; left:0; width:100%; height:100px;
    background:rgba(0,0,0,0.5); color:white; font-family:sans-serif;
    display:flex; justify-content:space-around; align-items:center;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud">
  <div>Health: <span id="health">100</span></div>
  <div>Ammo: <span id="ammo">50</span></div>
  <div>Score: <span id="score">0</span></div>
</div>

<script>
// Canvas setup
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Map setup (0 = empty, 1 = wall)
const map = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,2,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,2,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1],
];

// Textures
const wallTexture = new Image();
wallTexture.src = 'https://i.imgur.com/9b8Zp8N.jpg'; // Brick texture

const enemyTexture = new Image();
enemyTexture.src = 'https://i.imgur.com/q1bHqfG.png'; // Red blob

// Player setup
const player = {
  x: 3.5,
  y: 3.5,
  angle: 0,
  fov: Math.PI/3,
  speed: 0.05
};

// Enemies
let enemies = [
  {x:7.5, y:2.5, health:50},
  {x:3.5, y:6.5, health:50}
];

// Key input
const keys = {};
document.addEventListener('keydown', e=>keys[e.key]=true);
document.addEventListener('keyup', e=>keys[e.key]=false);

// Raycasting function
function castRays() {
  const numRays = canvas.width;
  const stripWidth = canvas.width / numRays;
  for(let i=0;i<numRays;i++){
    const rayAngle = (player.angle - player.fov/2) + (i/numRays)*player.fov;
    let distance = 0;
    let hit = false;
    let hitX, hitY, textureX;
    let stepSize = 0.01;
    
    while(!hit && distance<20){
      distance += stepSize;
      const testX = Math.floor(player.x + Math.cos(rayAngle)*distance);
      const testY = Math.floor(player.y + Math.sin(rayAngle)*distance);
      if(map[testY] && map[testY][testX] > 0){
        hit = true;
        hitX = testX;
        hitY = testY;
        textureX = (player.x + Math.cos(rayAngle)*distance) % 1;
      }
    }

    if(hit){
      const wallHeight = (canvas.height / distance) * 0.8;
      ctx.drawImage(
        wallTexture,
        textureX*wallTexture.width, 0, 1, wallTexture.height,
        i*stripWidth, canvas.height/2 - wallHeight/2, stripWidth, wallHeight
      );
    }
  }
}

// Draw enemies
function drawEnemies() {
  enemies.forEach(enemy=>{
    const dx = enemy.x - player.x;
    const dy = enemy.y - player.y;
    const distance = Math.sqrt(dx*dx + dy*dy);
    const angleToEnemy = Math.atan2(dy, dx) - player.angle;
    if(Math.abs(angleToEnemy) < player.fov/2){
      const size = (canvas.height / distance) * 0.8;
      const screenX = (0.5 + (angleToEnemy/player.fov)) * canvas.width - size/2;
      ctx.drawImage(enemyTexture, screenX, canvas.height/2 - size/2, size, size);
    }
  });
}

// Game loop
function gameLoop(){
  // Movement
  if(keys['w']) player.x += Math.cos(player.angle)*player.speed;
  if(keys['s']) player.x -= Math.cos(player.angle)*player.speed;
  if(keys['w']) player.y += Math.sin(player.angle)*player.speed;
  if(keys['s']) player.y -= Math.sin(player.angle)*player.speed;
  if(keys['a']) player.angle -= 0.03;
  if(keys['d']) player.angle += 0.03;

  // Clear
  ctx.fillStyle = 'black';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw 3D
  castRays();
  drawEnemies();

  requestAnimationFrame(gameLoop);
}

wallTexture.onload = () => enemyTexture.onload = () => gameLoop();
</script>
</body>
</html>
