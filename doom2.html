<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini-Doom Homage — Textured Walls & Red Blob Enemies</title>
<style>
  :root { --accent:#ff4d3f; --accent2:#ffd14d; }
  html,body{height:100%;margin:0;background:#050505;color:#ddd;font-family:system-ui,-apple-system,Segoe UI,Roboto;}
  canvas#game{display:block;width:100%;height:100vh;background:#000;}
  #minimap{position:absolute;left:12px;top:12px;background:rgba(0,0,0,0.28);padding:8px;border-radius:8px;}
  #help{position:absolute;right:12px;top:12px;color:#ddd;font-size:13px;background:rgba(0,0,0,0.28);padding:8px 10px;border-radius:8px;}
  #crosshair{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:rgba(255,255,255,0.9);font-size:22px;pointer-events:none;text-shadow:0 1px 0 #000;}
  /* Doom-style HUD */
  #doomHUD{position:absolute;left:50%;transform:translateX(-50%);bottom:8px;width:920px;max-width:calc(100% - 28px);height:112px;background:linear-gradient(180deg,rgba(0,0,0,0.35),rgba(10,7,7,0.65));border-radius:6px;padding:10px;display:flex;gap:14px;align-items:stretch;box-shadow:0 10px 30px rgba(0,0,0,0.6);font-weight:800;}
  #facePanel{width:160px;background:linear-gradient(180deg,#1a1513,#0f0d0c);border-radius:6px;display:flex;align-items:center;justify-content:center;padding:6px;}
  canvas#face{width:128px;height:96px;image-rendering:pixelated;border-radius:4px;background:#2b2624;border:2px solid rgba(255,255,255,0.06);}
  .bigHP{font-size:48px;color:var(--accent);font-family:monospace;}
  .hpBarWrap{width:260px;height:18px;background:#0b0b0b;border-radius:6px;overflow:hidden;}
  .hpBar{height:100%;width:100%;background:linear-gradient(90deg,#ff6b56,#ff2f1f);transition:width 0.12s linear;}
  .statBox{width:220px;height:36px;background:#131212;border-radius:6px;display:flex;align-items:center;justify-content:space-between;padding:6px 10px;}
  .statLabel{font-size:11px;opacity:0.8;}
  .statValue{font-size:20px;font-family:monospace;color:var(--accent2);}
  /* small screen */
  @media (max-width:920px){
    #doomHUD{height:96px;padding:8px;}
    #facePanel{width:120px;}
    .bigHP{font-size:38px;}
    .hpBarWrap{width:180px;}
    canvas#face{width:96px;height:72px;}
  }
  #damageFlash{position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;mix-blend-mode:screen;}
</style>
</head>
<body>
<canvas id="game" width=1024 height=640></canvas>
<div id="minimap"><canvas id="map" width=160 height=160></canvas></div>
<div id="help">WASD • Mouse look • Click / SPACE to fire • R restart</div>
<div id="crosshair">+</div>

<!-- HUD -->
<div id="doomHUD" aria-hidden="true">
  <div id="facePanel">
    <canvas id="face" width=32 height=24></canvas>
  </div>

  <div style="flex:1;display:flex;gap:12px;align-items:center;">
    <div style="display:flex;flex-direction:column;gap:6px;width:260px;">
      <div style="font-size:12px;opacity:0.9;">HEALTH</div>
      <div class="bigHP" id="hpBig">100</div>
      <div class="hpBarWrap"><div id="hpBar" class="hpBar" style="width:100%"></div></div>
    </div>

    <div style="width:1px;height:76px;background:linear-gradient(180deg,#000,rgba(255,255,255,0.02));margin-left:12px;margin-right:12px;"></div>

    <div style="display:flex;flex-direction:column;gap:10px;">
      <div style="display:flex;gap:8px;">
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">ARMOR</div>
          <div class="statBox">
            <div class="statLabel">ARM</div>
            <div id="armorVal" class="statValue">0</div>
          </div>
        </div>
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">KILLS</div>
          <div class="statBox">
            <div class="statLabel">KILL</div>
            <div id="kills" class="statValue">0</div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px;">
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">WEAPON</div>
          <div class="statBox">
            <div id="weaponName" class="statLabel">Pistol</div>
            <div id="weaponIcon" class="statValue">●</div>
          </div>
        </div>
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">AMMO</div>
          <div class="statBox">
            <div class="statLabel">AMMO</div>
            <div id="ammoVal" class="statValue">50</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div style="width:240px;display:flex;flex-direction:column;align-items:flex-end;gap:8px;"></div>
</div>

<div id="damageFlash"></div>

<script>
/* ========== CORE & CANVAS ========== */
const WIDTH = 1024, HEIGHT = 640;
const FOV = Math.PI / 3; // 60° FOV
const canvas = document.getElementById('game');
canvas.width = WIDTH; canvas.height = HEIGHT;
const ctx = canvas.getContext('2d');

const mapCanvas = document.getElementById('map');
const mctx = mapCanvas.getContext('2d');

const faceCanvas = document.getElementById('face');
const fctx = faceCanvas.getContext('2d');
faceCanvas.style.imageRendering = 'pixelated';

ctx.imageSmoothingEnabled = false;
mctx.imageSmoothingEnabled = false;
fctx.imageSmoothingEnabled = false;

const depthBuffer = new Array(WIDTH).fill(Infinity);

/* ========== UTILITIES ========== */
function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }
function normalizeAngle(a){ while(a>Math.PI)a-=2*Math.PI; while(a<-Math.PI)a+=2*Math.PI; return a; }

/* ========== MAP ========== */
const MAP = [
  "########################",
  "#......................#",
  "#..##...##.............#",
  "#..##...##..#..........#",
  "#...........#..........#",
  "#..###..###...##.......#",
  "#..#...........#.......#",
  "#..#..##......#........#",
  "#.....##..E.....E......#",
  "#..........##........#.#",
  "#..E......##..E........#",
  "#...............##.....#",
  "#..............#.......#",
  "########################"
];
function mapGet(x,y){ if(y<0||y>=MAP.length||x<0||x>=MAP[0].length) return '#'; return MAP[y][x]; }

/* ========== PLAYER ========== */
let player = { x:2.5, y:2.5, dir:0, pitch:0, hp:100, armor:50, ammo:50 };
let kills = 0, damageFlash = 0;

/* ========== INPUT ========== */
const keys = {}; let mouseDown=false;
window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);
canvas.addEventListener('mousedown', ()=> { mouseDown=true; shoot(); canvas.requestPointerLock?.(); });
window.addEventListener('mouseup', ()=>mouseDown=false);
window.addEventListener('mousemove', e=>{ if(document.pointerLockElement===canvas){ player.dir += e.movementX*0.0035; player.pitch = clamp(player.pitch + e.movementY*0.003,-0.65,0.65); } });
window.addEventListener('keydown', e=>{ if(e.key===' ') shoot(); });

/* ========== WALL TEXTURES ========== */
const WALL_TEX_SIZE=64;
const wallTextures=[];
function makeBrickTexture(){ const c=document.createElement('canvas'); c.width=c.height=WALL_TEX_SIZE; const cx=c.getContext('2d'); cx.fillStyle='#8a6f56'; cx.fillRect(0,0,WALL_TEX_SIZE,WALL_TEX_SIZE); return c; }
function makeStoneTexture(){ const c=document.createElement('canvas'); c.width=c.height=WALL_TEX_SIZE; const cx=c.getContext('2d'); cx.fillStyle='#6b6f72'; cx.fillRect(0,0,WALL_TEX_SIZE,WALL_TEX_SIZE); return c; }
function makeMetalTexture(){ const c=document.createElement('canvas'); c.width=c.height=WALL_TEX_SIZE; const cx=c.getContext('2d'); cx.fillStyle='#3a4852'; cx.fillRect(0,
cx.fillRect(0,0,WALL_TEX_SIZE,WALL_TEX_SIZE); return c; }

wallTextures.push(makeBrickTexture(), makeStoneTexture(), makeMetalTexture());

/* ========== ENEMIES ========== */
let enemies = [];
for(let y=0;y<MAP.length;y++){
  for(let x=0;x<MAP[0].length;x++){
    if(MAP[y][x]==='E'){
      enemies.push({x:x+0.5, y:y+0.5, hp:20});
    }
  }
}

/* ========== SHOOTING ========== */
function shoot(){
  if(player.ammo<=0) return;
  player.ammo--;
  const rayX = Math.cos(player.dir);
  const rayY = Math.sin(player.dir);
  for(let i=0;i<enemies.length;i++){
    const e=enemies[i];
    const dx=e.x-player.x, dy=e.y-player.y;
    const dist=Math.sqrt(dx*dx+dy*dy);
    const angle=Math.atan2(dy,dx)-player.dir;
    if(Math.abs(angle)<0.15 && dist<8){
      e.hp-=10;
      damageFlash=0.2;
      if(e.hp<=0){ enemies.splice(i,1); kills++; i--; }
    }
  }
}

/* ========== RENDERING ========== */
function render(){
  ctx.fillStyle='#000';
  ctx.fillRect(0,0,WIDTH,HEIGHT);
  depthBuffer.fill(Infinity);

  // Walls (simple raycasting)
  for(let x=0;x<WIDTH;x++){
    const rayAngle=player.dir - FOV/2 + FOV*(x/WIDTH);
    let rx=player.x, ry=player.y;
    const step=0.05;
    for(let dist=0;dist<20;dist+=step){
      rx = player.x + Math.cos(rayAngle)*dist;
      ry = player.y + Math.sin(rayAngle)*dist;
      if(mapGet(Math.floor(rx),Math.floor(ry))===' #' || mapGet(Math.floor(rx),Math.floor(ry))==='#'){
        const tex = wallTextures[0]; // all walls same for demo
        const hitX = (rx%1)*WALL_TEX_SIZE;
        const col = Math.floor(hitX);
        ctx.fillStyle = ctx.createPattern(tex,'repeat');
        const h = HEIGHT/(dist+0.1);
        ctx.fillRect(x, HEIGHT/2 - h/2, 1, h);
        depthBuffer[x] = dist;
        break;
      }
    }
  }

  // Enemies
  enemies.forEach(e=>{
    const dx=e.x-player.x;
    const dy=e.y-player.y;
    const dist=Math.sqrt(dx*dx+dy*dy);
    const angle=normalizeAngle(Math.atan2(dy,dx)-player.dir);
    if(Math.abs(angle)<FOV/2 && dist>0.3){
      const size = 300/dist;
      const ex = WIDTH/2 + Math.tan(angle)*(WIDTH/2)/Math.tan(FOV/2) - size/2;
      ctx.fillStyle='red';
      ctx.fillRect(ex, HEIGHT/2 - size/2, size, size);
      for(let sx=Math.floor(ex);sx<ex+size;sx++){
        if(sx>=0 && sx<WIDTH) depthBuffer[sx] = Math.min(depthBuffer[sx], dist);
      }
    }
  });

  // Damage flash
  if(damageFlash>0){
    const flashDiv = document.getElementById('damageFlash');
    flashDiv.style.background = `rgba(255,0,0,${damageFlash})`;
    damageFlash-=0.03;
  } else {
    document.getElementById('damageFlash').style.background='transparent';
  }

  // Minimap
  mctx.fillStyle='#111'; mctx.fillRect(0,0,160,160);
  for(let y=0;y<MAP.length;y++){
    for(let x=0;x<MAP[0].length;x++){
      if(MAP[y][x]==='#') mctx.fillStyle='#888';
      else if(MAP[y][x]==='E') mctx.fillStyle='red';
      else mctx.fillStyle='#222';
      mctx.fillRect(x*6,y*6,6,6);
    }
  }
  mctx.fillStyle='lime';
  mctx.fillRect(player.x*6-2,player.y*6-2,4,4);

  // HUD
  document.getElementById('hpBig').innerText = player.hp;
  document.getElementById('hpBar').style.width = player.hp+'%';
  document.getElementById('armorVal').innerText = player.armor;
  document.getElementById('ammoVal').innerText = player.ammo;
  document.getElementById('kills').innerText = kills;

  requestAnimationFrame(render);
}

/* ========== PLAYER MOVEMENT ========== */
function update(dt){
  const speed=dt*2;
  let dx=0,dy=0;
  if(keys['w']){ dx+=Math.cos(player.dir)*speed; dy+=Math.sin(player.dir)*speed; }
  if(keys['s']){ dx-=Math.cos(player.dir)*speed; dy-=Math.sin(player.dir)*speed; }
  if(keys['a']){ dx+=Math.cos(player.dir-Math.PI/2)*speed; dy+=Math.sin(player.dir-Math.PI/2)*speed; }
  if(keys['d']){ dx+=Math.cos(player.dir+Math.PI/2)*speed; dy+=Math.sin(player.dir+Math.PI/2)*speed; }

  // collision
  if(mapGet(Math.floor(player.x+dx),Math.floor(player.y))==='.') player.x+=dx;
  if(mapGet(Math.floor(player.x),Math.floor(player.y+dy))==='.') player.y+=dy;

  if(mouseDown) shoot();
}

let last=0;
function loop(ts){
  const dt = (ts-last)/1000; last=ts;
  update(dt);
  render();
  requestAnimationFrame(loop);
}

loop(0);
</script>
</body>
</html>
