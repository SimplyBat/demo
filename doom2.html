<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Doom: Cacodemon Edition</title>
<style>
html, body { margin:0; padding:0; height:100%; background:#000; overflow:hidden; font-family: monospace; }
canvas { display:block; background:#000; image-rendering: pixelated; }
#crosshair { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); color:white; font-size:24px; pointer-events:none; }
#doomHUD { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); width:920px; max-width:calc(100%-28px); height:112px; background:linear-gradient(180deg,rgba(0,0,0,0.35),rgba(10,7,7,0.65)); border-radius:6px; padding:10px; display:flex; gap:14px; align-items:stretch; box-shadow:0 10px 30px rgba(0,0,0,0.6); font-weight:800; color:white; }
#facePanel { width:160px; background:linear-gradient(180deg,#1a1513,#0f0d0c); border-radius:6px; display:flex; align-items:center; justify-content:center; padding:6px; }
canvas#face { width:128px; height:96px; image-rendering: pixelated; border-radius:4px; background:#2b2624; border:2px solid rgba(255,255,255,0.06); }
.bigHP { font-size:48px; color:#ff4d3f; font-family: monospace; }
.hpBarWrap { width:260px; height:18px; background:#0b0b0b; border-radius:6px; overflow:hidden; }
.hpBar { height:100%; width:100%; background:linear-gradient(90deg,#ff6b56,#ff2f1f); transition:width 0.12s linear; }
.statBox { width:220px; height:36px; background:#131212; border-radius:6px; display:flex; align-items:center; justify-content:space-between; padding:6px 10px; }
.statLabel { font-size:11px; opacity:0.8; }
.statValue { font-size:20px; font-family: monospace; color:#ffd14d; }
#damageFlash { position:absolute; top:0; left:0; right:0; bottom:0; pointer-events:none; mix-blend-mode:screen; }
</style>
</head>
<body>
<canvas id="game" width="1024" height="640"></canvas>
<div id="crosshair">+</div>

<div id="doomHUD" aria-hidden="true">
  <div id="facePanel"><canvas id="face" width=32 height=24></canvas></div>
  <div style="flex:1;display:flex;gap:12px;align-items:center;">
    <div style="display:flex;flex-direction:column;gap:6px;width:260px;">
      <div style="font-size:12px;opacity:0.9;">HEALTH</div>
      <div class="bigHP" id="hpBig">100</div>
      <div class="hpBarWrap"><div id="hpBar" class="hpBar" style="width:100%"></div></div>
    </div>
    <div style="width:1px;height:76px;background:linear-gradient(180deg,#000,rgba(255,255,255,0.02));margin-left:12px;margin-right:12px;"></div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div style="display:flex;gap:8px;">
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">ARMOR</div>
          <div class="statBox"><div class="statLabel">ARM</div><div id="armorVal" class="statValue">0</div></div>
        </div>
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">KILLS</div>
          <div class="statBox"><div class="statLabel">KILL</div><div id="kills" class="statValue">0</div></div>
        </div>
      </div>
      <div style="display:flex;gap:8px;">
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">WEAPON</div>
          <div class="statBox"><div id="weaponName" class="statLabel">Pistol</div><div id="weaponIcon" class="statValue">‚óè</div></div>
        </div>
        <div style="width:110px;">
          <div style="font-size:11px;opacity:0.8;">AMMO</div>
          <div class="statBox"><div class="statLabel">AMMO</div><div id="ammoVal" class="statValue">50</div></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="damageFlash"></div>

<script>
// ======= CORE =======
const canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
const WIDTH = canvas.width, HEIGHT = canvas.height;
ctx.imageSmoothingEnabled = false;

const MAP = [
"################",
"#..............#",
"#..##...##.....#",
"#..##...##..#..#",
"#...........#..#",
"#..###..###...##",
"#..#...........#",
"#..#..##......#",
"#..............#",
"#..E......E...#",
"#..........##..#",
"#..E.......E...#",
"################"
];

let player = { x:2.5, y:2.5, dir:0, pitch:0, hp:100, armor:0, ammo:50, speed:0.05 };
let keys = {}, mouseDown=false, kills=0, damageFlash=0;
let depthBuffer = new Float32Array(WIDTH);

// ======= INPUT =======
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
canvas.addEventListener('mousedown', e=>{ mouseDown=true; shoot(); canvas.requestPointerLock?.(); });
window.addEventListener('mouseup', e=>mouseDown=false);
window.addEventListener('mousemove', e=>{
  if(document.pointerLockElement===canvas){
    player.dir += e.movementX*0.0035;
    player.pitch = clamp(player.pitch+e.movementY*0.003,-0.65,0.65);
  }
});

// ======= UTIL =======
function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }
function mapGet(x,y){ if(y<0||y>=MAP.length||x<0||x>=MAP[0].length)return '#'; return MAP[y][x]; }

// ======= WALL TEXTURES =======
const wallTextures=[];
function makeBrickTexture(w=64,h=64){
  const c=document.createElement('canvas'), cx=c.getContext('2d'); c.width=w;c.height=h;
  cx.fillStyle="#8a6f56"; cx.fillRect(0,0,w,h);
  const rows=4,cols=8,bw=w/cols,bh=h/rows;
  for(let r=0;r<rows;r++) for(let col=0;col<cols;col++){
    const jitter=(Math.random()*0.08-0.04)*255;
    const base=140+Math.floor(Math.random()*40)+(r*6);
    const color=`rgb(${clamp(base+jitter,80,230)},${clamp(base-30+jitter,60,200)},${clamp(base-40+jitter,50,180)})`;
    const x=Math.floor(col*bw+((r%2)?bw*0.5:0))%w, y=Math.floor(r*bh);
    cx.fillStyle=color; cx.fillRect(x+2,y+2,Math.ceil(bw)-4,Math.ceil(bh)-4);
    cx.fillStyle='rgba(0,0,0,0.12)'; cx.fillRect(x+2,y+Math.ceil(bh)-6,Math.ceil(bw)-4,4);
  }
  return c;
}
wallTextures.push(makeBrickTexture());

// ======= ENEMY: CACODEMON =======
class Enemy{
  constructor(x,y){
    this.x=x; this.y=y; this.hp=20; this.speed=0.015; this.size=0.4;
    this.sprite=this.makeSprite();
    this.attackTimer=0;
  }
  makeSprite(){
    const c=document.createElement('canvas'), cx=c.getContext('2d'); c.width=32;c.height=32;
    cx.fillStyle="#ff2f2f"; cx.beginPath(); cx.arc(16,16,14,0,2*Math.PI); cx.fill();
    cx.fillStyle="#880000"; cx.beginPath(); cx.arc(16,20,6,0,Math.PI); cx.fill();
    cx.fillStyle="white"; cx.beginPath(); cx.arc(11,12,3,0,2*Math.PI); cx.fill();
    cx.beginPath(); cx.arc(21,12,3,0,2*Math.PI); cx.fill();
    cx.fillStyle="black"; cx.beginPath(); cx.arc(11,12,1.5,0,2*Math.PI); cx.fill();
    cx.beginPath(); cx.arc(21,12,1.5,0,2*Math.PI); cx.fill();
    return c;
  }
  update(){
    let dx = player.x-this.x, dy = player.y-this.y;
    let dist = Math.sqrt(dx*dx+dy*dy);
    if(dist>0.6){ this.x += (dx/dist)*this.speed; this.y += (dy/dist)*this.speed; }
    if(dist<0.6){ player.hp -= 0.3; damageFlash=0.4; }
    // Fireball attack
    this.attackTimer++;
    if(this.attackTimer>=180 && dist<5){
      let norm=Math.sqrt(dx*dx+dy*dy);
      projectiles.push(new Projectile(this.x,this.y,dx/norm,dy/norm));
      this.attackTimer=0;
    }
  }
  draw(){ const sx=(this.x-player.x)*64+WIDTH/2, sy=(this.y-player.y)*64+HEIGHT/2; ctx.drawImage(this.sprite,sx-16,sy-16); }
}

let enemies=[];
for(let y=0;y<MAP.length;y++) for(let x=0;x<MAP[0].length;x++){
  if(MAP[y][x]=='E') enemies.push(new Enemy(x+0.5,y+0.5));
}

// ======= PROJECTILES =======
class Projectile{
  constructor(x,y,dx,dy,speed=0.08,damage=5){ this.x=x; this.y=y; this.dx=dx; this.dy=dy; this.speed=speed; this.damage=damage; this.size=0.15; }
  update(){
    this.x += this.dx*this.speed; this.y += this.dy*this.speed;
    let pdx=this.x-player.x, pdy=this.y-player.y, dist=Math.sqrt(pdx*pdx+pdy*pdy);
    if(dist<0.4){ player.hp-=this.damage; damageFlash=0.4; return false; }
    if(mapGet(Math.floor(this.x), Math.floor(this.y))=='#') return false;
    return true;
  }
  draw(){ const sx=(this.x-player.x)*64+WIDTH/2, sy=(this.y-player.y)*64+HEIGHT/2;
    ctx.fillStyle="#ff6600"; ctx.beginPath(); ctx.arc(sx,sy,this.size*64,0,Math.PI*2); ctx.fill(); }
}
let projectiles=[];

// ======= SHOOT =======
function shoot(){ if(player.ammo>0){ player.ammo--; enemies.forEach(e=>{ let dx=e.x-player.x, dy=e.y-player.y, dist=Math.sqrt(dx*dx+dy*dy); if(dist<1.5){ e.hp-=10; if(e.hp<=0){ kills++; enemies.splice(enemies.indexOf(e),1); } } }); updateHUD(); } }

// ======= HUD =======
function updateHUD(){
  document.getElementById('hpBig').innerText=Math.floor(player.hp);
  document.getElementById('hpBar').style.width=Math.max(player.hp,0)+'%';
  document.getElementById('ammoVal').innerText=player.ammo;
  document.getElementById('kills').innerText=kills;
}

// ======= MOVEMENT =======
function movePlayer(){
  if(keys['w']){ player.y -= Math.cos(player.dir)*player.speed; player.x += Math.sin(player.dir)*player.speed; }
  if(keys['s']){ player.y += Math.cos(player.dir)*player.speed
; player.x -= Math.sin(player.dir)*player.speed; }
  if(keys['a']){ player.y -= Math.sin(player.dir)*player.speed; player.x -= Math.cos(player.dir)*player.speed; }
  if(keys['d']){ player.y += Math.sin(player.dir)*player.speed; player.x += Math.cos(player.dir)*player.speed; }
  requestAnimationFrame(movePlayer);
}
movePlayer();
canvas.addEventListener('mousedown', shoot);

// ======= PROJECTILE UPDATES =======
function updateProjectiles(){
  for(let i = projectiles.length-1; i>=0; i--){
    if(!projectiles[i].update()) projectiles.splice(i,1);
  }
}

function drawProjectiles(){
  projectiles.forEach(p=>p.draw());
}

// ======= GAME LOOP =======
function gameLoop(){
  ctx.clearRect(0,0,WIDTH,HEIGHT);

  // Draw floor
  ctx.fillStyle="#333"; ctx.fillRect(0,HEIGHT/2,WIDTH,HEIGHT/2);

  // Draw walls
  for(let y=0; y<MAP.length; y++){
    for(let x=0; x<MAP[0].length; x++){
      if(MAP[y][x]=='#'){
        const sx = (x-player.x)*64 + WIDTH/2;
        const sy = (y-player.y)*64 + HEIGHT/2;
        ctx.drawImage(wallTextures[0], sx, sy, 64, 64);
      }
    }
  }

  // Update & draw enemies
  enemies.forEach(e=>e.update());
  enemies.forEach(e=>e.draw());

  // Update & draw projectiles
  updateProjectiles();
  drawProjectiles();

  // Damage flash
  if(damageFlash>0){
    document.getElementById('damageFlash').style.background = `rgba(255,0,0,${damageFlash})`;
    damageFlash -= 0.02;
  } else {
    document.getElementById('damageFlash').style.background = '';
  }

  updateHUD();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
