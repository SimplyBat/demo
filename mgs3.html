<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
<script>
const scene = new THREE.Scene();

// Lights
const ambient = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambient);
const directional = new THREE.DirectionalLight(0xffffff, 0.8);
directional.position.set(10, 20, 10);
scene.add(directional);

// Ground
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(100, 100),
  new THREE.MeshPhongMaterial({color: 0x228B22})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Player cube
const player = new THREE.Mesh(
  new THREE.BoxGeometry(1, 2, 1),
  new THREE.MeshPhongMaterial({color: 0x00ff00})
);
player.position.set(0, 1, 0);
scene.add(player);

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 3, 6); // behind and above the player
camera.lookAt(player.position);

// Renderer
const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controls
const controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener('click', () => controls.lock());

// Movement
const move = {forward:0, backward:0, left:0, right:0, crouch:false};
document.addEventListener('keydown', e => {
  if(e.code==='KeyW') move.forward=1;
  if(e.code==='KeyS') move.backward=1;
  if(e.code==='KeyA') move.left=1;
  if(e.code==='KeyD') move.right=1;
  if(e.code==='ControlLeft') move.crouch=true;
});
document.addEventListener('keyup', e => {
  if(e.code==='KeyW') move.forward=0;
  if(e.code==='KeyS') move.backward=0;
  if(e.code==='KeyA') move.left=0;
  if(e.code==='KeyD') move.right=0;
  if(e.code==='ControlLeft') move.crouch=false;
});

// Animation loop
const clock = new THREE.Clock();
function animate() {
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  const speed = move.crouch ? 2 : 5;

  // Move player
  player.translateZ((move.forward - move.backward) * delta * speed);
  player.translateX((move.right - move.left) * delta * speed);

  // Camera follows player
  camera.position.lerp(new THREE.Vector3(player.position.x, player.position.y+3, player.position.z+6), 0.1);
  camera.lookAt(player.position);

  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
