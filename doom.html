<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2D Mini DOOM</title>
<style>
  body { margin: 0; background: black; display: flex; justify-content: center; align-items: center; height: 100vh; }
  canvas { background: #111; display: block; border: 2px solid #555; }
</style>
</head>
<body>
<canvas id="game" width="600" height="400"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const map = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,1,0,1,0,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,0,1,1,0,1,0,1,1,0,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,1,0,1,0,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
];

const TILE = 40;
const player = { x: 2*TILE, y: 2*TILE, size: 20, speed: 2, color: 'white', bullets: [] };
let score = 0;

// Enemies
const enemies = [
  { x: 10*TILE, y: 2*TILE, size: 20, speed: 1, color: 'red' },
  { x: 12*TILE, y: 6*TILE, size: 20, speed: 1, color: 'red' }
];

const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Shooting
document.addEventListener('keydown', e => {
  if(e.key === ' ') { // spacebar
    player.bullets.push({ x: player.x, y: player.y, dx: Math.cos(player.angle)*5, dy: Math.sin(player.angle)*5, size: 5 });
  }
});

// Game loop
function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

function update() {
  // Player movement
  if(keys['ArrowUp']) movePlayer(player.speed);
  if(keys['ArrowDown']) movePlayer(-player.speed);
  if(keys['ArrowLeft']) player.angle -= 0.1;
  if(keys['ArrowRight']) player.angle += 0.1;

  // Update bullets
  player.bullets.forEach((b,i) => {
    b.x += b.dx;
    b.y += b.dy;

    // Check collision with walls
    const mx = Math.floor(b.x/TILE);
    const my = Math.floor(b.y/TILE);
    if(map[my] && map[my][mx] === 1) player.bullets.splice(i,1);

    // Check collision with enemies
    enemies.forEach((e,ei)=>{
      if(Math.abs(b.x-e.x)<e.size && Math.abs(b.y-e.y)<e.size){
        player.bullets.splice(i,1);
        enemies.splice(ei,1);
        score++;
      }
    });
  });

  // Enemy movement toward player
  enemies.forEach(e=>{
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist = Math.hypot(dx,dy);
    const nx = (dx/dist) * e.speed;
    const ny = (dy/dist) * e.speed;

    // Collision with walls
    const mx = Math.floor((e.x+nx)/TILE);
    const my = Math.floor((e.y+ny)/TILE);
    if(map[my][mx] === 0){ e.x += nx; e.y += ny; }

    // Check collision with player
    if(Math.abs(e.x-player.x)<player.size && Math.abs(e.y-player.y)<player.size){
      alert('Game Over! Score: '+score);
      location.reload();
    }
  });
}

function movePlayer(speed) {
  const nx = player.x + Math.cos(player.angle)*speed;
  const ny = player.y + Math.sin(player.angle)*speed;
  const mx = Math.floor(nx/TILE);
  const my = Math.floor(ny/TILE);
  if(map[my] && map[my][mx] === 0){ player.x = nx; player.y = ny; }
}

function draw() {
  ctx.fillStyle = '#111';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw map
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      if(map[y][x]===1){
        ctx.fillStyle='#666';
        ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
      }
    }
  }

  // Draw player
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size/2, 0, Math.PI*2);
  ctx.fill();

  // Draw bullets
  player.bullets.forEach(b=>{
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.size/2,0,Math.PI*2);
    ctx.fill();
  });

  // Draw enemies
  enemies.forEach(e=>{
    ctx.fillStyle = e.color;
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.size/2,0,Math.PI*2);
    ctx.fill();
  });

  // Draw score
  ctx.fillStyle='white';
  ctx.font='20px sans-serif';
  ctx.fillText('Score: '+score,10,20);
}

gameLoop();
</script>
</body>
</html>
