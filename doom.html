<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini DOOM</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const map = [
  [1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1]
];

let player = {
  x: 3.5,
  y: 3.5,
  angle: 0,
  speed: 0
};

const keys = {};

// Controls
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Raycasting
function castRays() {
  const fov = Math.PI / 3;
  const numRays = canvas.width;
  for(let i=0;i<numRays;i++){
    const rayAngle = player.angle - fov/2 + fov * (i/numRays);
    let distance = 0;
    let hit = false;
    let rayX = player.x;
    let rayY = player.y;
    while(!hit && distance<20){
      rayX += 0.05 * Math.cos(rayAngle);
      rayY += 0.05 * Math.sin(rayAngle);
      distance += 0.05;
      if(map[Math.floor(rayY)][Math.floor(rayX)] === 1) hit = true;
    }
    const wallHeight = (canvas.height / (distance + 0.001)) * 50;
    ctx.fillStyle = `rgb(${255 / (distance*0.5)},0,0)`; // shading
    ctx.fillRect(i, canvas.height/2 - wallHeight/2, 1, wallHeight);
  }
}

// Game loop
function gameLoop() {
  // Movement
  if(keys['ArrowUp']) {
    player.x += 0.05 * Math.cos(player.angle);
    player.y += 0.05 * Math.sin(player.angle);
  }
  if(keys['ArrowDown']) {
    player.x -= 0.05 * Math.cos(player.angle);
    player.y -= 0.05 * Math.sin(player.angle);
  }
  if(keys['ArrowLeft']) player.angle -= 0.03;
  if(keys['ArrowRight']) player.angle += 0.03;

  ctx.fillStyle = 'black';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  castRays();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
