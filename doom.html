<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini DOOM Working 3D</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 400;

// Map: 1 = wall, 0 = empty
const MAP = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,0,1,1,0,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1]
];

const TILE = 64; // pixels per tile
let player = { x: TILE*2.5, y: TILE*2.5, angle:0 };

const FOV = Math.PI/3;
const NUM_RAYS = 200;
const MAX_DEPTH = 300;

const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

function castRays() {
  const sliceWidth = canvas.width / NUM_RAYS;

  for(let i=0;i<NUM_RAYS;i++){
    const rayAngle = player.angle - FOV/2 + FOV*(i/NUM_RAYS);
    let distance = 0;
    let hit=false;
    let rayX = player.x;
    let rayY = player.y;

    while(!hit && distance<MAX_DEPTH){
      rayX += Math.cos(rayAngle);
      rayY += Math.sin(rayAngle);
      distance += 1;
      const mapX = Math.floor(rayX/TILE);
      const mapY = Math.floor(rayY/TILE);
      if(MAP[mapY] && MAP[mapY][mapX]===1) hit=true;
    }

    const correctedDist = distance * Math.cos(rayAngle - player.angle);
    const wallHeight = (TILE*canvas.height)/correctedDist;

    // ceiling
    ctx.fillStyle = '#444';
    ctx.fillRect(i*sliceWidth, 0, sliceWidth, canvas.height/2 - wallHeight/2);

    // floor
    ctx.fillStyle = '#222';
    ctx.fillRect(i*sliceWidth, canvas.height/2 + wallHeight/2, sliceWidth, canvas.height/2 - wallHeight/2);

    // wall
    const shade = Math.max(50, 255 - correctedDist);
    ctx.fillStyle = `rgb(${shade},0,0)`;
    ctx.fillRect(i*sliceWidth, canvas.height/2 - wallHeight/2, sliceWidth, wallHeight);
  }
}

function gameLoop(){
  const moveSpeed = 2; // pixels/frame
  const rotSpeed = 0.03;

  if(keys['ArrowUp']){
    const nx = player.x + moveSpeed*Math.cos(player.angle);
    const ny = player.y + moveSpeed*Math.sin(player.angle);
    if(MAP[Math.floor(ny/TILE)][Math.floor(nx/TILE)]===0){ player.x=nx; player.y=ny; }
  }
  if(keys['ArrowDown']){
    const nx = player.x - moveSpeed*Math.cos(player.angle);
    const ny = player.y - moveSpeed*Math.sin(player.angle);
    if(MAP[Math.floor(ny/TILE)][Math.floor(nx/TILE)]===0){ player.x=nx; player.y=ny; }
  }
  if(keys['ArrowLeft']) player.angle -= rotSpeed;
  if(keys['ArrowRight']) player.angle += rotSpeed;

  ctx.fillStyle='black';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  castRays();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
