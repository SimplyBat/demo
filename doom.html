<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini DOOM</title>
<style>
  body { margin: 0; overflow: hidden; background: black; }
  canvas { display: block; }
</style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// Map: 1 = wall, 0 = empty
const map = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,0,1,1,0,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1],
];

let player = { x: 2.5, y: 2.5, angle: 0 };

// Controls
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Raycasting
function castRays() {
  const fov = Math.PI / 3;
  const numRays = 120;
  const sliceWidth = canvas.width / numRays;

  for(let i = 0; i < numRays; i++) {
    const rayAngle = player.angle - fov/2 + fov*(i/numRays);
    let distance = 0;
    let hit = false;
    let rayX = player.x;
    let rayY = player.y;

    while(!hit && distance < 20) {
      rayX += 0.1 * Math.cos(rayAngle); // step size increased
      rayY += 0.1 * Math.sin(rayAngle);
      distance += 0.1;
      if(map[Math.floor(rayY)][Math.floor(rayX)] === 1) hit = true;
    }

    // Fish-eye correction
    distance *= Math.cos(rayAngle - player.angle);

    const wallHeight = Math.min(canvas.height, 200 / distance);

    // Ceiling
    ctx.fillStyle = '#555';
    ctx.fillRect(i*sliceWidth, 0, sliceWidth, canvas.height/2 - wallHeight/2);
    // Floor
    ctx.fillStyle = '#222';
    ctx.fillRect(i*sliceWidth, canvas.height/2 + wallHeight/2, sliceWidth, canvas.height/2 - wallHeight/2);
    // Wall
    const shade = Math.max(50, 255 - distance*20);
    ctx.fillStyle = `rgb(${shade},0,0)`;
    ctx.fillRect(i*sliceWidth, canvas.height/2 - wallHeight/2, sliceWidth, wallHeight);
  }
}

// Game loop
function gameLoop() {
  const moveSpeed = 0.05;
  const rotSpeed = 0.03;
  if(keys['ArrowUp']){
    const nx = player.x + moveSpeed * Math.cos(player.angle);
    const ny = player.y + moveSpeed * Math.sin(player.angle);
    if(map[Math.floor(ny)][Math.floor(nx)] === 0){ player.x = nx; player.y = ny; }
  }
  if(keys['ArrowDown']){
    const nx = player.x - moveSpeed * Math.cos(player.angle);
    const ny = player.y - moveSpeed * Math.sin(player.angle);
    if(map[Math.floor(ny)][Math.floor(nx)] === 0){ player.x = nx; player.y = ny; }
  }
  if(keys['ArrowLeft']) player.angle -= rotSpeed;
  if(keys['ArrowRight']) player.angle += rotSpeed;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  castRays();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
